# 파인 튜닝 가이드

## pyannote 파인튜닝 for speaker diarizaiton purpose
pyannote는 [pyannote.audio](https://github.com/pyannote/pyannote-audio/tree/main/tutorials)의 파인튜닝 가이드를 참고하였습니다. <br>
pyannote의 speaker diarization pipeline을 보유하신 데이터셋에 맞게 파인튜닝하는 과정은 다음과 같습니다.  
- Pyannote-segmentation 모델 파인튜닝
- Optimizing the pipeline hyper-parameters

본 가이드라인을 따르기 위해서는, 데이터셋을 다음과 같이 구성해야 합니다. ([pyannote.database](https://github.com/pyannote/pyannote-database) 참고) <br>
데이터셋 별로 포맷 변경에 필요한 작업이 다를 수 있기 때문에, 저희가 사용한 데이터셋을 포맷변환한 내용을 공유하겠습니다. (utils 폴더 내)

- dataset
    - train.txt (각 txt 파일에는 각 세트에 해당하는 데이터의 uri가 담깁니다.(파일명))
    - dev.txt
    - test.txt
    - train (학습 용도) 
        - wav (or else) folder
            - {uri}.wav
        - rttm folder
            - {uri}.rttm
        - uem folder
            - {uri}.uem
    - dev (pipeline hyper-parameters optimize 용도)
        - 동일
    - test (테스트)
        - 동일

## NeMo 파인튜닝


# 파인튜닝 성능  
- loss/val/segmentation
    - 검증 데이터에서 segmentation loss - 음성 분할 관련 손실
    - 낮을수록 모델이 더 정확하게 분할됨
- loss/val/vad
    - 검증 데이터에서 음성 활동 감지 (VAD) loss 값
- loss/val
    - 전체 검증 loss 값
    - 작을수록 모델이 더 정확함
- DiarizationErrorRate
    - 전체 화자인식 오류율(DER)
    - 작을수록 좋음
- DiarizationErrorRate/Confusion
    - 화자 간 혼동률 - 잘못된 화자 매칭 비율
    - 낮을수록 좋음
- DiarizationErrorRate/FalseAlarm
    - 음성이 없는데 있다고 감지한 비율
    - 낮을수록 좋음
- DiarizationErrorRate/Miss
    - 놓친 음성 비율
    - 낮을수록 좋음
- DiarizationErrorRate/Threshold
    - DER 계산 시 사용된 임계값

| Epoch | loss/val/segmentation | loss/val/vad | loss/val | DiarizationErrorRate | DiarizationErrorRate/Confusion | DiarizationErrorRate/FalseAlarm | DiarizationErrorRate/Miss | DiarizationErrorRate/Threshold |
|-------|------------------------|--------------|----------|----------------------|--------------------------------|---------------------------------|---------------------------|--------------------------------|
| 0     | 0.5552                 | 0.7175       | 1.2727   | 0.9687               | 0.0144                         | 0.0235                          | 0.9308                     | 0.6000                         |
| 1     | 0.5537                 | 0.7226       | 1.2763   | 0.9687               | 0.0144                         | 0.0235                          | 0.9308                     | 0.6000                         |
| 2     | 0.2458                 | 0.2565       | 0.5023   | 0.2805               | 0.0482                         | 0.0816                          | 0.1508                     | 0.6600                         |
| 3     | 0.2479                 | 0.2567       | 0.5045   | 0.2805               | 0.0482                         | 0.0816                          | 0.1508                     | 0.6600                         |
| 4     | 0.2171                 | 0.2437       | 0.4608   | 0.2501               | 0.0352                         | 0.0796                          | 0.1353                     | 0.6200                         |
| 5     | 0.2213                 | 0.2440       | 0.4653   | 0.2501               | 0.0352                         | 0.0796                          | 0.1353                     | 0.6200                         |
| 6     | 0.2055                 | 0.2363       | 0.4417   | 0.2402               | 0.0311                         | 0.0781                          | 0.1311                     | 0.5800                         |
| 7     | 0.2094                 | 0.2367       | 0.4460   | 0.2402               | 0.0311                         | 0.0781                          | 0.1311                     | 0.5800                         |
| 8     | 0.2018                 | 0.2329       | 0.4347   | 0.2362               | 0.0297                         | 0.0790                          | 0.1274                     | 0.5800                         |
| 9     | 0.2061                 | 0.2336       | 0.4397   | 0.2362               | 0.0297                         | 0.0790                          | 0.1274                     | 0.5800                         |
| 10    | 0.1981                 | 0.2311       | 0.4292   | 0.2344               | 0.0289                         | 0.0798                          | 0.1258                     | 0.5600                         |
| 11    | 0.2027                 | 0.2323       | 0.4350   | 0.2344               | 0.0289                         | 0.0798                          | 0.1258                     | 0.5600                         |
| 12    | 0.1971                 | 0.2288       | 0.4259   | 0.2310               | 0.0285                         | 0.0771                          | 0.1254                     | 0.5600                         |
| 13    | 0.2009                 | 0.2300       | 0.4308   | 0.2310               | 0.0285                         | 0.0771                          | 0.1254                     | 0.5600                         |
| 14    | 0.1960                 | 0.2290       | 0.4250   | 0.2292               | 0.0278                         | 0.0761                          | 0.1253                     | 0.5800                         |
| 15    | 0.2000                 | 0.2305       | 0.4305   | 0.2292               | 0.0278                         | 0.0761                          | 0.1253                     | 0.5800                         |
| 16    | 0.1947                 | 0.2290       | 0.4237   | 0.2280               | 0.0273                         | 0.0754                          | 0.1253                     | 0.5800                         |
| 17    | 0.1983                 | 0.2306       | 0.4289   | 0.2280               | 0.0273                         | 0.0754                          | 0.1253                     | 0.5800                         |
| 18    | 0.1939                 | 0.2288       | 0.4227   | 0.2266               | 0.0268                         | 0.0754                          | 0.1244                     | 0.5800                         |
| 19    | 0.1975                 | 0.2300       | 0.4275   | 0.2266               | 0.0268                         | 0.0754                          | 0.1244                     | 0.5800                         |

